<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LAIN - Close The World, Open The Wired</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background-color: #0a0a0a;
            color: #00ff00;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 40px 0;
            border-bottom: 2px solid #00ff00;
            margin-bottom: 30px;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, transparent 0%, #001100 100%);
            pointer-events: none;
        }

        h1 {
            font-size: 3em;
            letter-spacing: 10px;
            text-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00;
            animation: glitch 3s infinite;
            position: relative;
            z-index: 1;
        }

        @keyframes glitch {
            0%, 90%, 100% {
                transform: translate(0);
            }
            92% {
                transform: translate(-2px, 2px);
            }
            94% {
                transform: translate(2px, -2px);
            }
            96% {
                transform: translate(-2px, -2px);
            }
        }

        .subtitle {
            color: #009900;
            font-size: 0.9em;
            margin-top: 10px;
            letter-spacing: 2px;
            position: relative;
            z-index: 1;
        }

        .search-box {
            margin: 30px 0;
            text-align: center;
        }

        .search-input {
            width: 80%;
            padding: 15px;
            background-color: #001100;
            border: 2px solid #00ff00;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            outline: none;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
        }

        .search-input::placeholder {
            color: #006600;
        }

        .search-input:focus {
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
        }

        .search-button {
            padding: 15px 30px;
            background-color: #00ff00;
            border: none;
            color: #0a0a0a;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            cursor: pointer;
            margin-left: 10px;
            text-transform: uppercase;
            font-weight: bold;
            transition: all 0.3s;
        }

        .search-button:hover {
            background-color: #00cc00;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.7);
        }

        .loading {
            text-align: center;
            color: #009900;
            margin: 20px 0;
            display: none;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .results {
            margin-top: 30px;
        }

        .result-item {
            background-color: #001100;
            border: 1px solid #00ff00;
            margin-bottom: 20px;
            padding: 20px;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.2);
            transition: all 0.3s;
        }

        .result-item:hover {
            box-shadow: 0 0 25px rgba(0, 255, 0, 0.4);
            transform: translateX(5px);
        }

        .result-title {
            font-size: 1.5em;
            color: #00ff00;
            margin-bottom: 10px;
            text-shadow: 0 0 5px #00ff00;
        }

        .result-title a {
            color: #00ff00;
            text-decoration: none;
            transition: all 0.3s;
        }

        .result-title a:hover {
            color: #00cc00;
            text-shadow: 0 0 10px #00ff00;
        }

        .result-snippet {
            color: #009900;
            line-height: 1.8;
            margin-bottom: 10px;
        }

        .result-url {
            color: #006600;
            font-size: 0.9em;
            word-break: break-all;
        }

        .no-results {
            text-align: center;
            color: #ff0000;
            margin-top: 30px;
            font-size: 1.2em;
            text-shadow: 0 0 10px #ff0000;
        }

        .footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            border-top: 2px solid #00ff00;
            color: #006600;
        }

        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            background: repeating-linear-gradient(
                to bottom,
                transparent 0px,
                transparent 2px,
                rgba(0, 255, 0, 0.03) 2px,
                rgba(0, 255, 0, 0.03) 4px
            );
        }

        .crt-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9998;
            background: radial-gradient(ellipse at center, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.3) 100%);
        }

        .lain-quote {
            color: #005500;
            font-size: 0.8em;
            margin-top: 12px;
            font-style: italic;
            letter-spacing: 1px;
            position: relative;
            z-index: 1;
            min-height: 1.4em;
        }

        .article-viewer {
            margin-top: 30px;
        }

        .article-back {
            display: inline-block;
            padding: 8px 20px;
            background-color: transparent;
            border: 1px solid #00ff00;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .article-back:hover {
            background-color: #00ff00;
            color: #0a0a0a;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
        }

        .article-content {
            background-color: #001100;
            border: 1px solid #00ff00;
            padding: 25px;
            line-height: 1.8;
            color: #00cc00;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.2);
        }

        .article-content h2 {
            color: #00ff00;
            font-size: 1.3em;
            margin: 20px 0 10px;
            text-shadow: 0 0 5px #00ff00;
            border-bottom: 1px solid #004400;
            padding-bottom: 5px;
        }

        .article-content h3 {
            color: #00dd00;
            font-size: 1.1em;
            margin: 15px 0 8px;
        }

        .article-content p {
            margin-bottom: 12px;
        }

        .article-content a {
            color: #00ff00;
            text-decoration: underline;
            cursor: pointer;
        }

        .article-content a:hover {
            text-shadow: 0 0 8px #00ff00;
        }

        .article-heading {
            font-size: 1.8em;
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
            margin-bottom: 15px;
        }

        .article-content img {
            max-width: 100%;
            height: auto;
            cursor: pointer;
            border: 1px solid #00ff00;
            transition: box-shadow 0.3s;
        }

        .article-content img:hover {
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
        }

        .image-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.92);
            z-index: 10000;
            cursor: pointer;
            justify-content: center;
            align-items: center;
        }

        .image-overlay.active {
            display: flex;
        }

        .image-overlay img {
            max-width: 90%;
            max-height: 90%;
            border: 2px solid #00ff00;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.4);
        }

        .result-item {
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .search-input {
                width: 100%;
                margin-bottom: 10px;
            }
            
            .search-button {
                margin-left: 0;
                width: 100%;
            }

            h1 {
                font-size: 2em;
                letter-spacing: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="scanlines"></div>
    <div class="crt-effect"></div>
    <div class="image-overlay" id="imageOverlay">
        <img id="overlayImage" src="" alt="Fullscreen image">
    </div>
    
    <div class="container">
        <header class="header">
            <h1>LAIN</h1>
            <p class="subtitle" id="subtitle">[ LAYER 01: WELCOME TO THE WIRED ]</p>
            <p class="lain-quote" id="lainQuote"></p>
        </header>

        <div class="search-box">
            <input type="text" 
                   class="search-input" 
                   id="searchInput" 
                   placeholder="ENTER SEARCH QUERY..."
                   autocomplete="off">
            <button class="search-button" id="searchButton">SEARCH</button>
        </div>

        <div class="loading" id="loading">
            &gt;&gt; ACCESSING WIRED DATABASE...
        </div>

        <div class="results" id="results"></div>

        <footer class="footer">
            <p>&gt; PRESENT DAY, PRESENT TIME &lt;</p>
            <p>No matter where you go, everyone's connected.</p>
        </footer>
    </div>

    <script>
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const loading = document.getElementById('loading');
        const results = document.getElementById('results');
        const lainQuote = document.getElementById('lainQuote');

        const LAIN_QUOTES = [
            "If you're not remembered, then you never existed.",
            "No matter where you go, everyone's connected.",
            "The Wired is an upper layer of the real world.",
            "You don't need to be afraid. I'm here.",
            "Close the world. Open the next.",
            "If you want to avoid pain, you should go back to being alone.",
            "People only have substance within the memories of others.",
            "I don't need to stay in the real world.",
            "Everyone is connected. I can reach everyone.",
        ];

        // Display a random Lain quote
        function showRandomQuote() {
            const idx = Math.floor(Math.random() * LAIN_QUOTES.length);
            lainQuote.textContent = `"${LAIN_QUOTES[idx]}"`;
        }
        showRandomQuote();

        // Image overlay close handlers
        const imageOverlay = document.getElementById('imageOverlay');
        imageOverlay.addEventListener('click', () => {
            imageOverlay.classList.remove('active');
        });
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                imageOverlay.classList.remove('active');
            }
        });

        // Search on button click
        searchButton.addEventListener('click', performSearch);

        // Search on Enter key
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        async function performSearch() {
            const query = searchInput.value.trim();
            
            if (!query) {
                return;
            }

            // Show loading
            loading.style.display = 'block';
            results.innerHTML = '';

            try {
                // Wikipedia API endpoint
                const url = `https://en.wikipedia.org/w/api.php?` +
                    `action=query&` +
                    `list=search&` +
                    `srsearch=${encodeURIComponent(query)}&` +
                    `format=json&` +
                    `origin=*&` +
                    `srlimit=10`;

                const response = await fetch(url);
                const data = await response.json();

                // Hide loading
                loading.style.display = 'none';

                if (data.query && data.query.search && data.query.search.length > 0) {
                    displayResults(data.query.search);
                } else {
                    results.innerHTML = '<div class="no-results">&gt;&gt; NO RESULTS FOUND IN THE WIRED &lt;&lt;</div>';
                }
            } catch (error) {
                loading.style.display = 'none';
                results.innerHTML = '<div class="no-results">&gt;&gt; CONNECTION TO THE WIRED FAILED &lt;&lt;</div>';
                console.error('Error:', error);
            }
        }

        function stripHtmlTags(html) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = html;
            return tempDiv.textContent || tempDiv.innerText || '';
        }

        function displayResults(searchResults) {
            results.innerHTML = '';

            searchResults.forEach(result => {
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';

                const title = document.createElement('div');
                title.className = 'result-title';
                title.textContent = `> ${result.title}`;

                const snippet = document.createElement('div');
                snippet.className = 'result-snippet';
                snippet.textContent = stripHtmlTags(result.snippet);

                resultItem.appendChild(title);
                resultItem.appendChild(snippet);

                resultItem.addEventListener('click', () => {
                    loadArticle(result.title);
                });

                results.appendChild(resultItem);
            });
        }

        async function loadArticle(title) {
            loading.style.display = 'block';
            results.innerHTML = '';

            try {
                const url = `https://en.wikipedia.org/w/api.php?` +
                    `action=parse&` +
                    `page=${encodeURIComponent(title)}&` +
                    `prop=text&` +
                    `format=json&` +
                    `origin=*`;

                const response = await fetch(url);
                const data = await response.json();

                loading.style.display = 'none';

                if (data.parse && data.parse.text) {
                    displayArticle(title, data.parse.text['*']);
                } else {
                    results.innerHTML = '<div class="no-results">&gt;&gt; ARTICLE NOT FOUND IN THE WIRED &lt;&lt;</div>';
                }
            } catch (error) {
                loading.style.display = 'none';
                results.innerHTML = '<div class="no-results">&gt;&gt; CONNECTION TO THE WIRED FAILED &lt;&lt;</div>';
                console.error('Error:', error);
            }
        }

        function getFullSizeImageUrl(thumbUrl) {
            // Wikipedia thumbnail URLs follow the pattern:
            // .../thumb/a/ab/File.jpg/220px-File.jpg
            // Full size URL removes '/thumb' and the trailing '/NNNpx-...' segment
            if (/\/thumb\//.test(thumbUrl)) {
                return thumbUrl.replace(/\/thumb\//, '/').replace(/\/\d+px-[^/]*$/, '');
            }
            return thumbUrl;
        }

        function displayArticle(title, html) {
            results.innerHTML = '';

            const viewer = document.createElement('div');
            viewer.className = 'article-viewer';

            const backBtn = document.createElement('button');
            backBtn.className = 'article-back';
            backBtn.textContent = '< BACK TO RESULTS';
            backBtn.addEventListener('click', performSearch);

            const heading = document.createElement('div');
            heading.className = 'article-heading';
            heading.textContent = `>> ${title}`;

            const content = document.createElement('div');
            content.className = 'article-content';

            // Parse the HTML and sanitize it
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = html;

            // Remove edit links, reference sections, and other UI elements
            tempDiv.querySelectorAll('.mw-editsection, .reference, .reflist, .navbox, .sistersitebox, .mw-empty-elt, .noprint, .mbox-small, .ambox, .metadata, style, .infobox, .sidebar, .toc, .hatnote').forEach(el => el.remove());

            // Convert Wikipedia internal links to clickable article links
            tempDiv.querySelectorAll('a[href^="/wiki/"]').forEach(link => {
                const articleTitle = decodeURIComponent(link.getAttribute('href').replace('/wiki/', '')).replace(/_/g, ' ');
                link.removeAttribute('href');
                link.style.cursor = 'pointer';
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    loadArticle(articleTitle);
                    window.scrollTo(0, 0);
                });
            });

            // Remove external links that won't work well inline
            tempDiv.querySelectorAll('a[href^="http"], a[href^="//"]').forEach(link => {
                if (link.textContent.trim()) {
                    const text = document.createTextNode(link.textContent);
                    link.parentNode.replaceChild(text, link);
                } else {
                    link.remove();
                }
            });

            // Make images clickable for fullscreen viewing
            tempDiv.querySelectorAll('img').forEach(img => {
                // Fix protocol-relative URLs
                const src = img.getAttribute('src');
                if (src && src.startsWith('//')) {
                    img.setAttribute('src', 'https:' + src);
                }
                const srcset = img.getAttribute('srcset');
                if (srcset) {
                    img.setAttribute('srcset', srcset.replace(/(^|,\s*)(\/\/)/g, '$1https:$2'));
                }
                img.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const overlay = document.getElementById('imageOverlay');
                    const overlayImg = document.getElementById('overlayImage');
                    // Use full-resolution image URL for the overlay
                    overlayImg.src = getFullSizeImageUrl(img.src);
                    overlay.classList.add('active');
                });
            });

            content.appendChild(tempDiv);

            viewer.appendChild(backBtn);
            viewer.appendChild(heading);
            viewer.appendChild(content);

            results.appendChild(viewer);
            window.scrollTo(0, 0);
        }

        // Add focus to search input on page load
        window.addEventListener('load', () => {
            searchInput.focus();
        });
    </script>
</body>
</html>
